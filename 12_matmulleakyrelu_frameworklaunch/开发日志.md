# MatmulLeakyRelu FrameworkLaunch 开发日志

## 2026-02-19：13(v2) -> 12(FrameworkLaunch) 平行移植

### 1. 迁移范围
- 源：`13_matmulleakyrelu_kernellaunch/Optimized/v2_algorithm/MatmulLeakyReluInvocationAsync`
- 目标：`12_matmulleakyrelu_frameworklaunch`
- 迁移内容：
  - `MatmulLeakyReluCustom/op_kernel/matmul_leakyrelu_custom.cpp`
  - `MatmulLeakyReluCustom/op_host/matmul_leakyrelu_custom.cpp`
  - `AclNNInvocation` 的 shape 参数化与性能采集链路

### 2. 关键改动
- 算子 kernel：迁移 v2 异步 `Iterate<false>` + 分行 LeakyReLU 路径（稳定版本，非 in-place 风险路径）。
- host tiling：迁移 v2 的 shape-key + split 候选 + core 搜索策略，并保留合法性校验。
- 动态参数：支持通过环境变量控制
  - `MATMUL_M/MATMUL_N/MATMUL_K`
  - `MATMUL_FORCE_CORE_NUM`
  - `MATMUL_FORCE_BASE_M/MATMUL_FORCE_BASE_N`
  - `MATMUL_ADAPTIVE_MAX_CORE`

### 3. 运行与性能采集
- `AclNNInvocation/run.sh` 已支持：
  - `-m/-n/-k` 动态 shape
  - `-t/--repeat` 重复运行并输出 `AVG/P50/P90`
  - `-P/--kernel-msprof` + `-Q/--msprof-repeat` + `-O/--msprof-output`
  - `-B/--build-only`、`-R/--run-only`、`--no-clean`
- 新增批量扫描脚本：
  - `AclNNInvocation/scripts/run_kernel_tune.sh`
  - 用于 S1/S2/S3 的 `core x baseM x baseN` 网格扫描，并汇总 csv/md。

### 4. 目录切换约束（后续开发）
- 后续优化与验证主目录切换为：
  - `envtrial/samples/operator/ascendc/0_introduction/12_matmulleakyrelu_frameworklaunch`
- `13_matmulleakyrelu_kernellaunch` 保留为历史参考，不再作为主开发目录。
