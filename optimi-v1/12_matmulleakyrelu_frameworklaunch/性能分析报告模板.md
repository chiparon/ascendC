# MatmulLeakyReluCustom APROF/msprof 性能分析报告模板

## 1. 测试环境
- 日期：
- 设备：Ascend 910Bx
- CANN：
- 自定义算子版本：
- 测试入口：`AclNNInvocation/run.sh`

## 2. 测试命令
```bash
cd envtrial/samples/operator/ascendc/0_introduction/12_matmulleakyrelu_frameworklaunch/AclNNInvocation

# 端到端耗时（AVG/P50/P90）
bash run.sh -m 2048 -n 2048 -k 2048 -t 5

# kernel profiling（msprof/APROF口径）
bash run.sh -m 2048 -n 2048 -k 2048 -t 1 -P -Q 3 -O ./msprof_s1

# 网格扫描（自动汇总 AVG/P50/P90 + kernel AVG/P50/P90）
bash scripts/run_kernel_tune.sh
```

## 3. 结果汇总
| Shape | 配置 | AVG(ms) | P50(ms) | P90(ms) | kernel AVG(ms) | kernel P50(ms) | kernel P90(ms) | error ratio | pass/fail |
|---|---|---:|---:|---:|---:|---:|---:|---:|---|
| S1(2048,2048,2048) | baseline |  |  |  |  |  |  |  |  |
| S1(2048,2048,2048) | optimized |  |  |  |  |  |  |  |  |
| S2(4096,1024,4096) | baseline |  |  |  |  |  |  |  |  |
| S2(4096,1024,4096) | optimized |  |  |  |  |  |  |  |  |

## 4. 提升率计算
- 提升率 = `(baseline_avg - optimized_avg) / baseline_avg * 100%`
- 目标：高维 shape（S1/S2）提升 >= 20%

## 5. APROF/msprof 瓶颈定位
- 数据来源：`msprof` 输出目录（按 run 分目录保存）
- 关注指标：
  - kernel 执行时长（与端到端时长分离）
  - hot kernel 占比
  - 计算/搬运占比
  - 多核利用率

## 6. 结论与后续优化
- 当前是否达到 >=20%：
- 未达标瓶颈：
- 下一轮优化动作（单变量）：
  - core
  - baseM/baseN
  - 流水/UB策略
