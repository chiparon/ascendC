# MatmulLeakyRelu 算子优化技术说明与性能分析报告

## 1. 环境信息
- 日期：
- 设备：Ascend（型号）
- 驱动/CANN版本：
- OS：
- 编译参数：
- 测试工具：APROF/msprof（版本）

## 2. 任务与算子定义
- 算子：MatmulLeakyRelu
- 公式：
  - C = A * B + Bias
  - C = C > 0 ? C : C * 0.001
- 输入输出类型与shape约束：
- 验证误差标准：

## 3. 测试方法
- 每个shape重复次数：
- 统计方式：去掉首轮后取平均/中位数
- 测试shape：
  - S1: (2048,2048,2048)
  - S2: (4096,1024,4096)
  - S3: ...
- 对比对象：
  - Baseline：优化前版本（commit/tag）
  - Optimized：优化后版本（commit/tag）

## 4. Baseline结果（优化前）
| Shape | 精度是否通过 | 平均耗时(ms) | p95(ms) | 备注 |
|---|---|---:|---:|---|

- APROF关键观察：
  - 热点阶段：
  - 访存/计算占比：
  - 主要瓶颈判断：

## 5. Roofline分析
- 峰值算力（理论）：
- 峰值带宽（理论）：
- 实测算子算术强度（AI）：
- 实测性能点位置与结论：
  - 当前更接近：带宽上限 / 算力上限
  - 依据：

## 6. 优化方案与实现细节
### 6.1 优化点A：Tiling策略
- 修改文件：
- 修改内容：
- 预期收益：
- 实际收益：

### 6.2 优化点B：片上内存复用（UB/L1）
- 修改文件：
- 修改内容：
- 预期收益：
- 实际收益：

### 6.3 优化点C：流水并行/搬运-计算重叠
- 修改文件：
- 修改内容：
- 预期收益：
- 实际收益：

## 7. 优化后结果
| Shape | Baseline(ms) | Optimized(ms) | Speedup(x) | 提升(%) | 精度是否通过 |
|---|---:|---:|---:|---:|---|

- 高维shape提升是否≥20%：
- 典型case说明：

## 8. 泛化与稳定性
- 未公开/动态shape测试结果：
- 稳定性结论：
- 失败case与原因（如有）：

## 9. 结论
- 核心收益总结：
- 剩余瓶颈：
- 下一步优化方向：

